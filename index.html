<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>EQ nback</title>
</head>

<body>
  <img 
    id="expression"
    src="./files/1.jpg" 
    alt="Expression" 
    style"
      display:block;
      text-align:center;
      "
  >
</body>

<script>

  
  // const expressionImageSrc = document.getElementById("expression").src;
  // console.log(expressionImageSrc);

  /** Emotinal n back consists of:
   *  nBackLevel - Number of steps to past the person playing game must remember
   *  delayBetweenSteps - Delay between steps in milliseconds
   *  numberOfStepsOnGame - number of steps which one game consists of
   *
   */

  // Tracking history of faces expressions in time.
  const stepsHistory = [];
  var nBackLevel = 2;
  var numberOfStepsToGameEnd = 10;
  var gameInterval;

  // Changing images of expressions
  var gameInterval = setInterval(
    () =>  {
      let pickedExpressionImage = `${Math.floor(Math.random() * 8) + 1}.jpg`
      document.getElementById("expression").src = `./files/${pickedExpressionImage}`
      stepsHistory.push({ pickedExpressionImage });
      // End the game after the certain number of repetion.
      numberOfStepsToGameEnd--;
      if (numberOfStepsToGameEnd === 0 ) clearInterval(gameInterval);
    },
    1000
  )

  const getActualStepIndex = () => stepsHistory.length - 1;


  const evaluateNBackStep = () => {
    const actualStepIndex = getActualStepIndex();
    console.log(stepsHistory);
    return stepsHistory[actualStepIndex - nBackLevel].pickedExpressionImage ===
    stepsHistory[actualStepIndex].pickedExpressionImage;
  }



  // Sensing key.
  document.onkeypress = ({ key }) => {
    const actualStepIndex = getActualStepIndex();
    // Evaluate if key was pressed at matching expression.
    key === " " && !stepsHistory[actualStepIndex].evaluation && (() => {
      const evaluation = evaluateNBackStep();
      
      // Storing score.
      stepsHistory[actualStepIndex] = { ...stepsHistory[actualStepIndex], evaluation };
      console.log(stepsHistory);
    })()
    
  }





  


  // Save the data about success rate.

</script>

</html>